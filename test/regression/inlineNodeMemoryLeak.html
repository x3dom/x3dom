<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<title>Inline: Scene which references an external box model</title>
</head>

<body>
    <h1>Inline: Scene which references an external bunny model</h1>
    <p>This test <strong>needs to be run from a server.</strong> Use make runserver from the rootlevel and visist <a href="http://localhost:8080/test/regression/inlineNodeMemoryLeak.html"></a>.</p>
    <p>This should test cyclic reference problem with the onreadystatechanged closure (<a href="https://github.com/x3dom/x3dom/issues/3">#3</a>). Pressing the FORCE button should not increase memory consumption indefinitely. There are some leaks because of the heavy use of closures, but the GC works in most cases. In Firefox it may take a lot of memory before GC runs. Chrome does a better job keeping the footprint around 18-25MB with this exmaple.</p>

    <p>Also see:</p>
    <ul>
        <li><a href="http://javascript.info/tutorial/memory-leaks">http://javascript.info/tutorial/memory-leaks</a></li>
        <li><a href="https://github.com/x3dom/x3dom/issues/3">https://github.com/x3dom/x3dom/issues/3</a></li>
        <li><a href="https://sourceforge.net/projects/x3dom/forums/forum/957286/topic/4500885">https://sourceforge.net/projects/x3dom/forums/forum/957286/topic/4500885</a></li>
        <li><a href="https://sourceforge.net/projects/x3dom/forums/forum/957286/topic/4492032">https://sourceforge.net/projects/x3dom/forums/forum/957286/topic/4492032</a></li>
    </ul>

    <p>The initial inline is not loaded intentionally.</p>

	    <!-- Use the same "x", "y", "width" and "height" attributes as SVG.
             Optionally support the "viewBox" and "preserveAspectRatio" just like SVG -->
	 <x3d id='ModelingViewport' class=" tiptip applytip" name="ModelingViewport" showStat='false' showLog='true' x='0px' y='0px' width='489px' height='461px' float='left' title='LMB to Rotate Model. CTRL & LMB to Pan. Mouse Wheel to Zoom'>  <!--LMB to Rotate Model. CTRL & LMB to Pan. Mouse Wheel to Zoom-->
     <scene>
                            <Background skyAngle='1.3 1.514 ' skyColor='1 .6 0 1 .7 .3 1 1 1'></Background>
                            <!--<Background skyAngle='1.3 1.514 ' skyColor='255 255 255'></Background>-->
                            <navigationInfo type='"EXAMINE" "ANY"'></navigationInfo>
                             <viewpoint id='frontcam' orientation='0 0 0 0' position='0 -7 430' fieldOfView='.5' centerOfRotation='0 0 0' description='Camera 1' ></viewpoint>
                            <viewpoint id='perspcam' orientation='-.5 2.5 0 .7' position='350 65 330' fieldOfView='.5' centerOfRotation='0 0 0' description='Camera 2'></viewpoint>
                            <viewpoint id='rightcam' orientation='0 1 0 -5' position='500 -5 50' fieldOfView='.5' centerOfRotation='0 0 0' description='Camera 3'></viewpoint>
                            <viewpoint id='topcam'  orientation='-.5 0 0 1.3' position='0 500 35' fieldOfView='.5' centerOfRotation='0 0 0' description="Camera 4"></viewpoint>
                                <Transform id="root" translation='-100 0 0' >
 			<Shape id='greenBox' >
        		<Appearance>

          			<Material diffuseColor="0 1 0"></Material>
        		</Appearance>
        		<Box size='100 100 100' ></Box>
      		</Shape>
		</Transform>
        <Transform id="bunny1" translation='100 0 0' >
			<Inline id="bunny" DEF="redBox" url="http://localhost:8080/example/scene/bunny.x3" load="true"></Inline>
		</Transform>
	  </Scene>

    </X3D>

    <button onclick="UpDateNode('bunny','http://localhost:8080/test/functional/media/data/flipper.x3d');">FORCE</button>

    <link rel="stylesheet" type="text/css" href="../../src/x3dom.css">

<!-- BEGIN:X3DOM -->
<meta http-equiv="X-UA-Compatible" content="chrome=1" />
<link rel="stylesheet" type="text/css" href="../../src/x3dom.css" />
<script type="text/javascript" src="../../src/lang/Array.js"></script>
<script type="text/javascript" src="../../src/Internals.js"></script>
<script type="text/javascript" src="../../src/debug.js"></script>
<script type="text/javascript" src="../../src/ImageLoadManager.js"></script>
<script type="text/javascript" src="../../src/lang/Properties.js"></script>
<script type="text/javascript" src="../../src/lang/DoublyLinkedList.js"></script>
<script type="text/javascript" src="../../src/util/EarClipping.js"></script>
<script type="text/javascript" src="../../src/X3DCanvas.js"></script>
<script type="text/javascript" src="../../src/Runtime.js"></script>
<script type="text/javascript" src="../../src/Main.js"></script>
<script type="text/javascript" src="../../src/gfx_webgl.js"></script>
<script type="text/javascript" src="../../src/gfx_flash.js"></script>
<script type="text/javascript" src="../../src/X3DDocument.js"></script>
<script type="text/javascript" src="../../src/MatrixMixer.js"></script>
<script type="text/javascript" src="../../src/Viewarea.js"></script>
<script type="text/javascript" src="../../src/Mesh.js"></script>
<script type="text/javascript" src="../../src/fields.js"></script>
<script type="text/javascript" src="../../src/nodes/NodeNameSpace.js"></script>
<script type="text/javascript" src="../../src/nodes/Core.js"></script>
<script type="text/javascript" src="../../src/nodes/Grouping.js"></script>
<script type="text/javascript" src="../../src/nodes/Bindable.js"></script>
<script type="text/javascript" src="../../src/nodes/Rendering.js"></script>
<script type="text/javascript" src="../../src/nodes/Shape.js"></script>
<script type="text/javascript" src="../../src/nodes/Lighting.js"></script>
<script type="text/javascript" src="../../src/nodes/Followers.js"></script>
<script type="text/javascript" src="../../src/nodes/Interpolation.js"></script>
<script type="text/javascript" src="../../src/nodes/Time.js"></script>
<script type="text/javascript" src="../../src/nodes/Networking.js"></script>
<script type="text/javascript" src="../../src/nodes/EnvironmentalEffects.js"></script>
<script type="text/javascript" src="../../src/nodes/Navigation.js"></script>
<script type="text/javascript" src="../../src/nodes/Text.js"></script>
<script type="text/javascript" src="../../src/nodes/Sound.js"></script>
<script type="text/javascript" src="../../src/nodes/Texturing.js"></script>
<script type="text/javascript" src="../../src/nodes/Shaders.js"></script>
<script type="text/javascript" src="../../src/nodes/Geometry3D.js"></script>
<script type="text/javascript" src="../../src/nodes/Geospatial.js"></script>
<script type="text/javascript" src="../../src/nodes/Geometry2D.js"></script>
<script type="text/javascript" src="../../src/nodes/VolumeRendering.js"></script>
<!-- END:X3DOM -->
<script type="text/javascript" src="../functional/media/js/tests.js"></script>

    <script>
        z = null;
        function UpDateNode(x,y) {
            z = document.getElementById(x)
            z.setAttribute('url',y);
            delete z;
        }
        <!--Node Update Method 1-->
    </script>

</body>
</html>